name: Trigger Quote Bot

on:
  schedule:
    # Wake Render 10 minutes before every hour from 6 AM–9 PM IST
    # IST = UTC +5:30 → correct wake range = 00:20–15:20 UTC
    - cron: "20 0-15 * * *"
  workflow_dispatch:

jobs:
  call-render:
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:

      - name: Wake Render (retry up to 5 times)
        run: |
          for i in {1..5}; do
            echo "Waking Render (attempt $i)..."
            STATUS=$(curl -s -o /dev/null -w "%{http_code}" "https://quebot-lg0y.onrender.com/")
            if [ "$STATUS" = "200" ]; then
              echo "Render awake!"
              break
            fi
            echo "Failed (HTTP $STATUS). Retrying in 5 seconds..."
            sleep 5
          done

      - name: Wait for cold start (2 minutes)
        run: |
          echo "Waiting 120 seconds for Render warm-up..."
          sleep 120

      - name: Call /run endpoint (ONE TIME ONLY)
        run: |
          echo "Calling /run to tweet..."
          curl -s "https://quebot-lg0y.onrender.com/run"
